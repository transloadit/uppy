{"version":3,"sources":["../../src/core/Utils.js"],"names":["throttle","require","fileType","isTouchDevice","window","navigator","maxTouchPoints","truncateString","str","length","substr","secondsToTime","rawSeconds","hours","Math","floor","minutes","seconds","toArray","list","Array","prototype","slice","call","getTimeStamp","date","Date","pad","getHours","toString","getMinutes","getSeconds","generateFileID","file","name","toLowerCase","replace","type","data","size","lastModified","filter","val","join","runPromiseSequence","functions","args","promise","Promise","resolve","forEach","func","then","isPreviewSupported","fileTypeSpecific","split","test","getArrayBuffer","chunk","reject","reader","FileReader","addEventListener","e","target","result","err","console","error","readAsArrayBuffer","getFileType","extensionsToMime","fileExtension","getFileNameAndExtension","extension","isRemote","mime","buffer","catch","mimeToExtensions","getFileTypeExtension","mimeType","fullFileName","re","fileExt","exec","fileName","isObjectURL","url","indexOf","getProportionalHeight","img","width","aspect","height","round","createThumbnail","targetWidth","originalUrl","URL","createObjectURL","onload","image","Image","src","revokeObjectURL","onerror","Error","targetHeight","canvas","resizeImage","canvasToBlob","blob","sourceWidth","sourceHeight","steps","log","stepScaled","downScaleInSteps","document","createElement","context","getContext","drawImage","source","currentWidth","currentHeight","i","quality","toBlob","dataURItoBlob","toDataURL","dataURI","opts","toFile","binary","atob","array","push","charCodeAt","File","Uint8Array","Blob","dataURItoFile","copyToClipboard","textToCopy","fallbackString","textArea","setAttribute","position","top","left","padding","border","outline","boxShadow","background","value","body","appendChild","select","magicCopyFailed","removeChild","prompt","successful","execCommand","getSpeed","fileProgress","bytesUploaded","timeElapsed","uploadStarted","uploadSpeed","getBytesRemaining","bytesTotal","getETA","bytesRemaining","secondsRemaining","prettyETA","time","hoursStr","minutesVal","minutesStr","secondsVal","secondsStr","isDOMElement","obj","nodeType","Node","ELEMENT_NODE","findDOMElement","element","querySelector","findAllDOMElements","elements","querySelectorAll","getSocketHost","regex","host","socketProtocol","location","protocol","_emitSocketProgress","uploader","progressData","progress","core","emitter","emit","id","emitSocketProgress","leading","trailing","settle","promises","resolutions","rejections","resolved","rejected","wait","all","map","errors","failed","module","exports"],"mappings":"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","file":"Utils.js","sourcesContent":["const throttle = require('lodash.throttle')\n// we inline file-type module, as opposed to using the NPM version,\n// because of this https://github.com/sindresorhus/file-type/issues/78\n// and https://github.com/sindresorhus/copy-text-to-clipboard/issues/5\nconst fileType = require('../vendor/file-type')\n\n/**\n * A collection of small utility functions that help with dom manipulation, adding listeners,\n * promises and other good things.\n *\n * @module Utils\n */\n\nfunction isTouchDevice () {\n  return 'ontouchstart' in window || // works on most browsers\n          navigator.maxTouchPoints   // works on IE10/11 and Surface\n}\n\nfunction truncateString (str, length) {\n  if (str.length > length) {\n    return str.substr(0, length / 2) + '...' + str.substr(str.length - length / 4, str.length)\n  }\n  return str\n\n  // more precise version if needed\n  // http://stackoverflow.com/a/831583\n}\n\nfunction secondsToTime (rawSeconds) {\n  const hours = Math.floor(rawSeconds / 3600) % 24\n  const minutes = Math.floor(rawSeconds / 60) % 60\n  const seconds = Math.floor(rawSeconds % 60)\n\n  return { hours, minutes, seconds }\n}\n\n/**\n * Converts list into array\n*/\nfunction toArray (list) {\n  return Array.prototype.slice.call(list || [], 0)\n}\n\n/**\n * Returns a timestamp in the format of `hours:minutes:seconds`\n*/\nfunction getTimeStamp () {\n  var date = new Date()\n  var hours = pad(date.getHours().toString())\n  var minutes = pad(date.getMinutes().toString())\n  var seconds = pad(date.getSeconds().toString())\n  return hours + ':' + minutes + ':' + seconds\n}\n\n/**\n * Adds zero to strings shorter than two characters\n*/\nfunction pad (str) {\n  return str.length !== 2 ? 0 + str : str\n}\n\n/**\n * Takes a file object and turns it into fileID, by converting file.name to lowercase,\n * removing extra characters and adding type, size and lastModified\n *\n * @param {Object} file\n * @return {String} the fileID\n *\n */\nfunction generateFileID (file) {\n  // filter is needed to not join empty values with `-`\n  return [\n    'uppy',\n    file.name ? file.name.toLowerCase().replace(/[^A-Z0-9]/ig, '') : '',\n    file.type,\n    file.data.size,\n    file.data.lastModified\n  ].filter(val => val).join('-')\n}\n\n/**\n * Runs an array of promise-returning functions in sequence.\n */\nfunction runPromiseSequence (functions, ...args) {\n  let promise = Promise.resolve()\n  functions.forEach((func) => {\n    promise = promise.then(() => func(...args))\n  })\n  return promise\n}\n\nfunction isPreviewSupported (fileType) {\n  if (!fileType) return false\n  const fileTypeSpecific = fileType.split('/')[1]\n  // list of images that browsers can preview\n  if (/^(jpeg|gif|png|svg|svg\\+xml|bmp)$/.test(fileTypeSpecific)) {\n    return true\n  }\n  return false\n}\n\nfunction getArrayBuffer (chunk) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader()\n    reader.addEventListener('load', function (e) {\n      // e.target.result is an ArrayBuffer\n      resolve(e.target.result)\n    })\n    reader.addEventListener('error', function (err) {\n      console.error('FileReader error' + err)\n      reject(err)\n    })\n    // file-type only needs the first 4100 bytes\n    reader.readAsArrayBuffer(chunk)\n  })\n}\n\nfunction getFileType (file) {\n  const extensionsToMime = {\n    'md': 'text/markdown',\n    'markdown': 'text/markdown',\n    'mp4': 'video/mp4',\n    'mp3': 'audio/mp3',\n    'svg': 'image/svg+xml'\n  }\n\n  const fileExtension = file.name ? getFileNameAndExtension(file.name).extension : null\n\n  if (file.isRemote) {\n    // some remote providers do not support file types\n    const mime = file.type ? file.type : extensionsToMime[fileExtension]\n    return Promise.resolve(mime)\n  }\n\n  // 1. try to determine file type from magic bytes with file-type module\n  // this should be the most trustworthy way\n  const chunk = file.data.slice(0, 4100)\n  return getArrayBuffer(chunk)\n    .then((buffer) => {\n      const type = fileType(buffer)\n      if (type && type.mime) {\n        return type.mime\n      }\n\n      // 2. if that’s no good, check if mime type is set in the file object\n      if (file.type) {\n        return file.type\n      }\n\n      // 3. if that’s no good, see if we can map extension to a mime type\n      if (fileExtension && extensionsToMime[fileExtension]) {\n        return extensionsToMime[fileExtension]\n      }\n\n      // if all fails, well, return empty\n      return null\n    })\n    .catch(() => {\n      return null\n    })\n}\n\n// TODO Check which types are actually supported in browsers. Chrome likes webm\n// from my testing, but we may need more.\n// We could use a library but they tend to contain dozens of KBs of mappings,\n// most of which will go unused, so not sure if that's worth it.\nconst mimeToExtensions = {\n  'video/ogg': 'ogv',\n  'audio/ogg': 'ogg',\n  'video/webm': 'webm',\n  'audio/webm': 'webm',\n  'video/mp4': 'mp4',\n  'audio/mp3': 'mp3'\n}\n\nfunction getFileTypeExtension (mimeType) {\n  return mimeToExtensions[mimeType] || null\n}\n\n/**\n* Takes a full filename string and returns an object {name, extension}\n*\n* @param {string} fullFileName\n* @return {object} {name, extension}\n*/\nfunction getFileNameAndExtension (fullFileName) {\n  var re = /(?:\\.([^.]+))?$/\n  var fileExt = re.exec(fullFileName)[1]\n  var fileName = fullFileName.replace('.' + fileExt, '')\n  return {\n    name: fileName,\n    extension: fileExt\n  }\n}\n\n/**\n * Check if a URL string is an object URL from `URL.createObjectURL`.\n *\n * @param {string} url\n * @return {boolean}\n */\nfunction isObjectURL (url) {\n  return url.indexOf('blob:') === 0\n}\n\nfunction getProportionalHeight (img, width) {\n  const aspect = img.width / img.height\n  return Math.round(width / aspect)\n}\n\n/**\n * Create a thumbnail for the given Uppy file object.\n *\n * @param {{data: Blob}} file\n * @param {number} width\n * @return {Promise}\n */\nfunction createThumbnail (file, targetWidth) {\n  const originalUrl = URL.createObjectURL(file.data)\n\n  const onload = new Promise((resolve, reject) => {\n    const image = new Image()\n    image.src = originalUrl\n    image.onload = () => {\n      URL.revokeObjectURL(originalUrl)\n      resolve(image)\n    }\n    image.onerror = () => {\n      // The onerror event is totally useless unfortunately, as far as I know\n      URL.revokeObjectURL(originalUrl)\n      reject(new Error('Could not create thumbnail'))\n    }\n  })\n\n  return onload.then((image) => {\n    const targetHeight = getProportionalHeight(image, targetWidth)\n    const canvas = resizeImage(image, targetWidth, targetHeight)\n    return canvasToBlob(canvas, 'image/png')\n  }).then((blob) => {\n    return URL.createObjectURL(blob)\n  })\n}\n\n/**\n * Resize an image to the target `width` and `height`.\n *\n * Returns a Canvas with the resized image on it.\n */\nfunction resizeImage (image, targetWidth, targetHeight) {\n  let sourceWidth = image.width\n  let sourceHeight = image.height\n\n  if (targetHeight < image.height / 2) {\n    const steps = Math.floor(Math.log(image.width / targetWidth) / Math.log(2))\n    const stepScaled = downScaleInSteps(image, steps)\n    image = stepScaled.image\n    sourceWidth = stepScaled.sourceWidth\n    sourceHeight = stepScaled.sourceHeight\n  }\n\n  const canvas = document.createElement('canvas')\n  canvas.width = targetWidth\n  canvas.height = targetHeight\n\n  const context = canvas.getContext('2d')\n  context.drawImage(image,\n    0, 0, sourceWidth, sourceHeight,\n    0, 0, targetWidth, targetHeight)\n\n  return canvas\n}\n\n/**\n * Downscale an image by 50% `steps` times.\n */\nfunction downScaleInSteps (image, steps) {\n  let source = image\n  let currentWidth = source.width\n  let currentHeight = source.height\n\n  for (let i = 0; i < steps; i += 1) {\n    const canvas = document.createElement('canvas')\n    const context = canvas.getContext('2d')\n    canvas.width = currentWidth / 2\n    canvas.height = currentHeight / 2\n    context.drawImage(source,\n      // The entire source image. We pass width and height here,\n      // because we reuse this canvas, and should only scale down\n      // the part of the canvas that contains the previous scale step.\n      0, 0, currentWidth, currentHeight,\n      // Draw to 50% size\n      0, 0, currentWidth / 2, currentHeight / 2)\n    currentWidth /= 2\n    currentHeight /= 2\n    source = canvas\n  }\n\n  return {\n    image: source,\n    sourceWidth: currentWidth,\n    sourceHeight: currentHeight\n  }\n}\n\n/**\n * Save a <canvas> element's content to a Blob object.\n *\n * @param {HTMLCanvasElement} canvas\n * @return {Promise}\n */\nfunction canvasToBlob (canvas, type, quality) {\n  if (canvas.toBlob) {\n    return new Promise((resolve) => {\n      canvas.toBlob(resolve, type, quality)\n    })\n  }\n  return Promise.resolve().then(() => {\n    return dataURItoBlob(canvas.toDataURL(type, quality), {})\n  })\n}\n\nfunction dataURItoBlob (dataURI, opts, toFile) {\n  // get the base64 data\n  var data = dataURI.split(',')[1]\n\n  // user may provide mime type, if not get it from data URI\n  var mimeType = opts.mimeType || dataURI.split(',')[0].split(':')[1].split(';')[0]\n\n  // default to plain/text if data URI has no mimeType\n  if (mimeType == null) {\n    mimeType = 'plain/text'\n  }\n\n  var binary = atob(data)\n  var array = []\n  for (var i = 0; i < binary.length; i++) {\n    array.push(binary.charCodeAt(i))\n  }\n\n  // Convert to a File?\n  if (toFile) {\n    return new File([new Uint8Array(array)], opts.name || '', {type: mimeType})\n  }\n\n  return new Blob([new Uint8Array(array)], {type: mimeType})\n}\n\nfunction dataURItoFile (dataURI, opts) {\n  return dataURItoBlob(dataURI, opts, true)\n}\n\n/**\n * Copies text to clipboard by creating an almost invisible textarea,\n * adding text there, then running execCommand('copy').\n * Falls back to prompt() when the easy way fails (hello, Safari!)\n * From http://stackoverflow.com/a/30810322\n *\n * @param {String} textToCopy\n * @param {String} fallbackString\n * @return {Promise}\n */\nfunction copyToClipboard (textToCopy, fallbackString) {\n  fallbackString = fallbackString || 'Copy the URL below'\n\n  return new Promise((resolve) => {\n    const textArea = document.createElement('textarea')\n    textArea.setAttribute('style', {\n      position: 'fixed',\n      top: 0,\n      left: 0,\n      width: '2em',\n      height: '2em',\n      padding: 0,\n      border: 'none',\n      outline: 'none',\n      boxShadow: 'none',\n      background: 'transparent'\n    })\n\n    textArea.value = textToCopy\n    document.body.appendChild(textArea)\n    textArea.select()\n\n    const magicCopyFailed = () => {\n      document.body.removeChild(textArea)\n      window.prompt(fallbackString, textToCopy)\n      resolve()\n    }\n\n    try {\n      const successful = document.execCommand('copy')\n      if (!successful) {\n        return magicCopyFailed('copy command unavailable')\n      }\n      document.body.removeChild(textArea)\n      return resolve()\n    } catch (err) {\n      document.body.removeChild(textArea)\n      return magicCopyFailed(err)\n    }\n  })\n}\n\nfunction getSpeed (fileProgress) {\n  if (!fileProgress.bytesUploaded) return 0\n\n  const timeElapsed = (new Date()) - fileProgress.uploadStarted\n  const uploadSpeed = fileProgress.bytesUploaded / (timeElapsed / 1000)\n  return uploadSpeed\n}\n\nfunction getBytesRemaining (fileProgress) {\n  return fileProgress.bytesTotal - fileProgress.bytesUploaded\n}\n\nfunction getETA (fileProgress) {\n  if (!fileProgress.bytesUploaded) return 0\n\n  const uploadSpeed = getSpeed(fileProgress)\n  const bytesRemaining = getBytesRemaining(fileProgress)\n  const secondsRemaining = Math.round(bytesRemaining / uploadSpeed * 10) / 10\n\n  return secondsRemaining\n}\n\nfunction prettyETA (seconds) {\n  const time = secondsToTime(seconds)\n\n  // Only display hours and minutes if they are greater than 0 but always\n  // display minutes if hours is being displayed\n  // Display a leading zero if the there is a preceding unit: 1m 05s, but 5s\n  const hoursStr = time.hours ? time.hours + 'h ' : ''\n  const minutesVal = time.hours ? ('0' + time.minutes).substr(-2) : time.minutes\n  const minutesStr = minutesVal ? minutesVal + 'm ' : ''\n  const secondsVal = minutesVal ? ('0' + time.seconds).substr(-2) : time.seconds\n  const secondsStr = secondsVal + 's'\n\n  return `${hoursStr}${minutesStr}${secondsStr}`\n}\n\n/**\n * Check if an object is a DOM element. Duck-typing based on `nodeType`.\n *\n * @param {*} obj\n */\nfunction isDOMElement (obj) {\n  return obj && typeof obj === 'object' && obj.nodeType === Node.ELEMENT_NODE\n}\n\n/**\n * Find a DOM element.\n *\n * @param {Node|string} element\n * @return {Node|null}\n */\nfunction findDOMElement (element) {\n  if (typeof element === 'string') {\n    return document.querySelector(element)\n  }\n\n  if (typeof element === 'object' && isDOMElement(element)) {\n    return element\n  }\n}\n\n/**\n * Find one or more DOM elements.\n *\n * @param {string} element\n * @return {Array|null}\n */\nfunction findAllDOMElements (element) {\n  if (typeof element === 'string') {\n    const elements = [].slice.call(document.querySelectorAll(element))\n    return elements.length > 0 ? elements : null\n  }\n\n  if (typeof element === 'object' && isDOMElement(element)) {\n    return [element]\n  }\n}\n\nfunction getSocketHost (url) {\n  // get the host domain\n  var regex = /^(?:https?:\\/\\/|\\/\\/)?(?:[^@\\n]+@)?(?:www\\.)?([^\\n]+)/\n  var host = regex.exec(url)[1]\n  var socketProtocol = location.protocol === 'https:' ? 'wss' : 'ws'\n\n  return `${socketProtocol}://${host}`\n}\n\nfunction _emitSocketProgress (uploader, progressData, file) {\n  const {progress, bytesUploaded, bytesTotal} = progressData\n  if (progress) {\n    uploader.core.log(`Upload progress: ${progress}`)\n    uploader.core.emitter.emit('core:upload-progress', {\n      uploader,\n      id: file.id,\n      bytesUploaded: bytesUploaded,\n      bytesTotal: bytesTotal\n    })\n  }\n}\n\nconst emitSocketProgress = throttle(_emitSocketProgress, 300, {leading: true, trailing: true})\n\nfunction settle (promises) {\n  const resolutions = []\n  const rejections = []\n  function resolved (value) {\n    resolutions.push(value)\n  }\n  function rejected (error) {\n    rejections.push(error)\n  }\n\n  const wait = Promise.all(\n    promises.map((promise) => promise.then(resolved, rejected))\n  )\n\n  return wait.then(() => {\n    if (rejections.length === promises.length) {\n      // Very ad-hoc multiple-error reporting, should wrap this in a\n      // CombinedError or whatever kind of error class instead.\n      const error = rejections[0]\n      error.errors = rejections\n      return Promise.reject(error)\n    }\n    return {\n      successful: resolutions,\n      failed: rejections\n    }\n  })\n}\n\nmodule.exports = {\n  generateFileID,\n  toArray,\n  getTimeStamp,\n  runPromiseSequence,\n  isTouchDevice,\n  getFileNameAndExtension,\n  truncateString,\n  getFileTypeExtension,\n  getFileType,\n  getArrayBuffer,\n  isPreviewSupported,\n  isObjectURL,\n  createThumbnail,\n  secondsToTime,\n  dataURItoBlob,\n  dataURItoFile,\n  canvasToBlob,\n  getSpeed,\n  getBytesRemaining,\n  getETA,\n  copyToClipboard,\n  prettyETA,\n  findDOMElement,\n  findAllDOMElements,\n  getSocketHost,\n  emitSocketProgress,\n  settle\n}\n"]}