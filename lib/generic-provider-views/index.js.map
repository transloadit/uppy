{"version":3,"sources":["../../src/generic-provider-views/index.js"],"names":["AuthView","require","Browser","LoaderView","Utils","module","exports","plugin","opts","Provider","id","defaultOptions","viewType","addFile","bind","filterItems","filterQuery","toggleSearch","getFolder","getNextFolder","logout","checkAuth","handleAuth","handleDemoAuth","sortByTitle","sortByDate","isActiveRow","handleError","handleScroll","render","updateState","newState","stateId","state","core","setState","_updateFilesAndFolders","res","files","folders","getItemSubList","forEach","item","isFolder","push","checkAuthInProgress","then","authenticated","onAuth","catch","err","name","_loaderWrapper","list","updatedDirectories","getState","index","directories","findIndex","dir","slice","concat","title","getItemName","folder","getItemRequestPath","file","tagFile","source","data","getItemData","getItemId","type","getMimeType","isRemote","body","fileId","remote","host","url","fileUrl","getFileType","isPreviewSupported","fileType","preview","getItemThumbnailUrl","log","location","href","json","ok","e","filterInput","target","value","searchInputEl","document","querySelector","isSearchVisible","focus","items","filter","toLowerCase","indexOf","sorting","sortedFiles","sort","fileA","fileB","localeCompare","sortedFolders","folderA","folderB","a","Date","getItemModifiedDate","b","sortBySize","length","size","activeRow","urlId","Math","floor","random","redirect","search","authState","btoa","JSON","stringify","link","authUrl","authWindow","window","open","authWindowUrl","DOMException","TypeError","setTimeout","split","close","error","message","i18n","toString","info","details","scrollPos","scrollHeight","scrollTop","offsetHeight","path","getNextPagePath","_isHandlingScroll","promise","catch_","loading","pluginName","demo","browserProps","getItemIcon"],"mappings":"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","file":"index.js","sourcesContent":["const AuthView = require('./AuthView')\nconst Browser = require('./Browser')\nconst LoaderView = require('./Loader')\nconst Utils = require('../core/Utils')\n\n/**\n * Class to easily generate generic views for plugins\n *\n * This class expects the plugin using to have the following attributes\n *\n * stateId {String} object key of which the plugin state is stored\n *\n * This class also expects the plugin instance using it to have the following\n * accessor methods.\n * Each method takes the item whose property is to be accessed\n * as a param\n *\n * isFolder\n *    @return {Boolean} for if the item is a folder or not\n * getItemData\n *    @return {Object} that is format ready for uppy upload/download\n * getItemIcon\n *    @return {Object} html instance of the item's icon\n * getItemSubList\n *    @return {Array} sub-items in the item. e.g a folder may contain sub-items\n * getItemName\n *    @return {String} display friendly name of the item\n * getMimeType\n *    @return {String} mime type of the item\n * getItemId\n *    @return {String} unique id of the item\n * getItemRequestPath\n *    @return {String} unique request path of the item when making calls to uppy server\n * getItemModifiedDate\n *    @return {object} or {String} date of when last the item was modified\n * getItemThumbnailUrl\n *    @return {String}\n */\nmodule.exports = class View {\n  /**\n   * @param {object} instance of the plugin\n   */\n  constructor (plugin, opts) {\n    this.plugin = plugin\n    this.Provider = plugin[plugin.id]\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'list'\n    }\n\n    // merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOptions, opts)\n\n    // Logic\n    this.addFile = this.addFile.bind(this)\n    this.filterItems = this.filterItems.bind(this)\n    this.filterQuery = this.filterQuery.bind(this)\n    this.toggleSearch = this.toggleSearch.bind(this)\n    this.getFolder = this.getFolder.bind(this)\n    this.getNextFolder = this.getNextFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.checkAuth = this.checkAuth.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.handleDemoAuth = this.handleDemoAuth.bind(this)\n    this.sortByTitle = this.sortByTitle.bind(this)\n    this.sortByDate = this.sortByDate.bind(this)\n    this.isActiveRow = this.isActiveRow.bind(this)\n    this.handleError = this.handleError.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n  }\n\n  /**\n   * Little shorthand to update the state with the plugin's state\n   */\n  updateState (newState) {\n    let stateId = this.plugin.stateId\n    const {state} = this.plugin.core\n\n    this.plugin.core.setState({[stateId]: Object.assign({}, state[stateId], newState)})\n  }\n\n  _updateFilesAndFolders (res, files, folders) {\n    this.plugin.getItemSubList(res).forEach((item) => {\n      if (this.plugin.isFolder(item)) {\n        folders.push(item)\n      } else {\n        files.push(item)\n      }\n    })\n\n    this.updateState({ folders, files })\n  }\n\n  checkAuth () {\n    this.updateState({ checkAuthInProgress: true })\n    this.Provider.checkAuth()\n      .then((authenticated) => {\n        this.updateState({ checkAuthInProgress: false })\n        this.plugin.onAuth(authenticated)\n      })\n      .catch((err) => {\n        this.updateState({ checkAuthInProgress: false })\n        this.handleError(err)\n      })\n  }\n\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   * @param  {String} id Folder id\n   * @return {Promise}   Folders/files in folder\n   */\n  getFolder (id, name) {\n    return this._loaderWrapper(\n      this.Provider.list(id),\n      (res) => {\n        let folders = []\n        let files = []\n        let updatedDirectories\n\n        const state = this.plugin.core.getState()[this.plugin.stateId]\n        const index = state.directories.findIndex((dir) => id === dir.id)\n\n        if (index !== -1) {\n          updatedDirectories = state.directories.slice(0, index + 1)\n        } else {\n          updatedDirectories = state.directories.concat([{id, title: name || this.plugin.getItemName(res)}])\n        }\n\n        this._updateFilesAndFolders(res, files, folders)\n        this.updateState({ directories: updatedDirectories })\n      },\n      this.handleError)\n  }\n\n  /**\n   * Fetches new folder\n   * @param  {Object} Folder\n   * @param  {String} title Folder title\n   */\n  getNextFolder (folder) {\n    let id = this.plugin.getItemRequestPath(folder)\n    this.getFolder(id, this.plugin.getItemName(folder))\n  }\n\n  addFile (file) {\n    const tagFile = {\n      source: this.plugin.id,\n      data: this.plugin.getItemData(file),\n      name: this.plugin.getItemName(file) || this.plugin.getItemId(file),\n      type: this.plugin.getMimeType(file),\n      isRemote: true,\n      body: {\n        fileId: this.plugin.getItemId(file)\n      },\n      remote: {\n        host: this.plugin.opts.host,\n        url: `${this.Provider.fileUrl(this.plugin.getItemRequestPath(file))}`,\n        body: {\n          fileId: this.plugin.getItemId(file)\n        }\n      }\n    }\n\n    Utils.getFileType(tagFile).then(fileType => {\n      if (Utils.isPreviewSupported(fileType[1])) {\n        tagFile.preview = this.plugin.getItemThumbnailUrl(file)\n      }\n      this.plugin.core.log('Adding remote file')\n      this.plugin.core.addFile(tagFile)\n    })\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  logout () {\n    this.Provider.logout(location.href)\n      .then((res) => res.json())\n      .then((res) => {\n        if (res.ok) {\n          const newState = {\n            authenticated: false,\n            files: [],\n            folders: [],\n            directories: []\n          }\n          this.updateState(newState)\n        }\n      }).catch(this.handleError)\n  }\n\n  filterQuery (e) {\n    const state = this.plugin.core.getState()[this.plugin.stateId]\n    this.updateState(Object.assign({}, state, {\n      filterInput: e.target.value\n    }))\n  }\n\n  toggleSearch () {\n    const state = this.plugin.core.getState()[this.plugin.stateId]\n    const searchInputEl = document.querySelector('.Browser-searchInput')\n\n    this.updateState(Object.assign({}, state, {\n      isSearchVisible: !state.isSearchVisible,\n      filterInput: ''\n    }))\n\n    searchInputEl.value = ''\n    if (!state.isSearchVisible) {\n      searchInputEl.focus()\n    }\n  }\n\n  filterItems (items) {\n    const state = this.plugin.core.getState()[this.plugin.stateId]\n    return items.filter((folder) => {\n      return this.plugin.getItemName(folder).toLowerCase().indexOf(state.filterInput.toLowerCase()) !== -1\n    })\n  }\n\n  sortByTitle () {\n    const state = Object.assign({}, this.plugin.core.getState()[this.plugin.stateId])\n    const {files, folders, sorting} = state\n\n    let sortedFiles = files.sort((fileA, fileB) => {\n      if (sorting === 'titleDescending') {\n        return this.plugin.getItemName(fileB).localeCompare(this.plugin.getItemName(fileA))\n      }\n      return this.plugin.getItemName(fileA).localeCompare(this.plugin.getItemName(fileB))\n    })\n\n    let sortedFolders = folders.sort((folderA, folderB) => {\n      if (sorting === 'titleDescending') {\n        return this.plugin.getItemName(folderB).localeCompare(this.plugin.getItemName(folderA))\n      }\n      return this.plugin.getItemName(folderA).localeCompare(this.plugin.getItemName(folderB))\n    })\n\n    this.updateState(Object.assign({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: (sorting === 'titleDescending') ? 'titleAscending' : 'titleDescending'\n    }))\n  }\n\n  sortByDate () {\n    const state = Object.assign({}, this.plugin.core.getState()[this.plugin.stateId])\n    const {files, folders, sorting} = state\n\n    let sortedFiles = files.sort((fileA, fileB) => {\n      let a = new Date(this.plugin.getItemModifiedDate(fileA))\n      let b = new Date(this.plugin.getItemModifiedDate(fileB))\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    let sortedFolders = folders.sort((folderA, folderB) => {\n      let a = new Date(this.plugin.getItemModifiedDate(folderA))\n      let b = new Date(this.plugin.getItemModifiedDate(folderB))\n\n      if (sorting === 'dateDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    this.updateState(Object.assign({}, state, {\n      files: sortedFiles,\n      folders: sortedFolders,\n      sorting: (sorting === 'dateDescending') ? 'dateAscending' : 'dateDescending'\n    }))\n  }\n\n  sortBySize () {\n    const state = Object.assign({}, this.plugin.core.getState()[this.plugin.stateId])\n    const {files, sorting} = state\n\n    // check that plugin supports file sizes\n    if (!files.length || !this.plugin.getItemData(files[0]).size) {\n      return\n    }\n\n    let sortedFiles = files.sort((fileA, fileB) => {\n      let a = this.plugin.getItemData(fileA).size\n      let b = this.plugin.getItemData(fileB).size\n\n      if (sorting === 'sizeDescending') {\n        return a > b ? -1 : a < b ? 1 : 0\n      }\n      return a > b ? 1 : a < b ? -1 : 0\n    })\n\n    this.updateState(Object.assign({}, state, {\n      files: sortedFiles,\n      sorting: (sorting === 'sizeDescending') ? 'sizeAscending' : 'sizeDescending'\n    }))\n  }\n\n  isActiveRow (file) {\n    return this.plugin.core.getState()[this.plugin.stateId].activeRow === this.plugin.getItemId(file)\n  }\n\n  handleDemoAuth () {\n    const state = this.plugin.core.getState()[this.plugin.stateId]\n    this.updateState({}, state, {\n      authenticated: true\n    })\n  }\n\n  handleAuth () {\n    const urlId = Math.floor(Math.random() * 999999) + 1\n    const redirect = `${location.href}${location.search ? '&' : '?'}id=${urlId}`\n\n    const authState = btoa(JSON.stringify({ redirect }))\n    const link = `${this.Provider.authUrl()}?state=${authState}`\n\n    const authWindow = window.open(link, '_blank')\n    const checkAuth = () => {\n      let authWindowUrl\n\n      try {\n        authWindowUrl = authWindow.location.href\n      } catch (e) {\n        if (e instanceof DOMException || e instanceof TypeError) {\n          return setTimeout(checkAuth, 100)\n        } else throw e\n      }\n\n      // split url because chrome adds '#' to redirects\n      if (authWindowUrl && authWindowUrl.split('#')[0] === redirect) {\n        authWindow.close()\n        this._loaderWrapper(this.Provider.checkAuth(), this.plugin.onAuth, this.handleError)\n      } else {\n        setTimeout(checkAuth, 100)\n      }\n    }\n\n    checkAuth()\n  }\n\n  handleError (error) {\n    const core = this.plugin.core\n    const message = core.i18n('uppyServerError')\n    core.log(error.toString())\n    core.info({message: message, details: error.toString()}, 'error', 5000)\n  }\n\n  handleScroll (e) {\n    const scrollPos = e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight)\n    const path = this.plugin.getNextPagePath ? this.plugin.getNextPagePath() : null\n\n    if (scrollPos < 50 && path && !this._isHandlingScroll) {\n      this.Provider.list(path)\n        .then((res) => {\n          const { files, folders } = this.plugin.core.getState()[this.plugin.stateId]\n          this._updateFilesAndFolders(res, files, folders)\n        }).catch(this.handleError)\n        .then(() => { this._isHandlingScroll = false }) // always called\n\n      this._isHandlingScroll = true\n    }\n  }\n\n  // displays loader view while asynchronous request is being made.\n  _loaderWrapper (promise, then, catch_) {\n    promise\n      .then(then).catch(catch_)\n      .then(() => this.updateState({ loading: false })) // always called.\n    this.updateState({ loading: true })\n  }\n\n  render (state) {\n    const { authenticated, checkAuthInProgress, loading } = state[this.plugin.stateId]\n\n    if (loading) {\n      return LoaderView()\n    }\n\n    if (!authenticated) {\n      return AuthView({\n        pluginName: this.plugin.title,\n        demo: this.plugin.opts.demo,\n        checkAuth: this.checkAuth,\n        handleAuth: this.handleAuth,\n        handleDemoAuth: this.handleDemoAuth,\n        checkAuthInProgress: checkAuthInProgress\n      })\n    }\n\n    const browserProps = Object.assign({}, state[this.plugin.stateId], {\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      addFile: this.addFile,\n      filterItems: this.filterItems,\n      filterQuery: this.filterQuery,\n      toggleSearch: this.toggleSearch,\n      sortByTitle: this.sortByTitle,\n      sortByDate: this.sortByDate,\n      logout: this.logout,\n      demo: this.plugin.opts.demo,\n      isActiveRow: this.isActiveRow,\n      getItemName: this.plugin.getItemName,\n      getItemIcon: this.plugin.getItemIcon,\n      handleScroll: this.handleScroll,\n      title: this.plugin.title,\n      viewType: this.opts.viewType\n    })\n\n    return Browser(browserProps)\n  }\n}\n"]}